<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settlement - Aspect Web App</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css">
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <header class="header">
        <div class="header-left">
            <h1>Aspect Web App</h1>
            <span class="header-subtitle">Invoice & Payment Settlement</span>
        </div>
        <div class="header-right">
            <span id="userDisplay" class="user-display"></span>
            <button id="logoutBtn" class="btn btn-secondary btn-sm">Logout</button>
        </div>
    </header>

    <main class="main-content">
        <!-- Filters Section -->
        <section class="filters-section">
            <div class="filter-group">
                <label for="counterpartyFilter">Counterparty:</label>
                <select id="counterpartyFilter">
                    <option value="">All Counterparties</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="currencyFilter">Currency:</label>
                <select id="currencyFilter">
                    <option value="">All Currencies</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="statusFilter">Status:</label>
                <select id="statusFilter">
                    <option value="all">All</option>
                    <option value="open" selected>Open (Unpaid)</option>
                </select>
            </div>
            <button id="refreshBtn" class="btn btn-primary">
                <svg class="icon" viewBox="0 0 24 24" width="16" height="16">
                    <path fill="currentColor" d="M17.65 6.35A7.958 7.958 0 0012 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0112 18c-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                </svg>
                Refresh
            </button>
        </section>

        <!-- Two Column Layout -->
        <div class="grid-container">
            <!-- Invoices Grid -->
            <section class="grid-section">
                <div class="grid-header">
                    <h2>Invoices</h2>
                    <div class="grid-actions">
                        <span id="invoiceCount" class="count-badge">0</span>
                    </div>
                </div>
                <div class="grid-summary">
                    <span>Selected: <strong id="selectedInvoicesCount">0</strong></span>
                    <span>Amount: <strong id="selectedInvoicesAmount">0.00</strong></span>
                </div>
                <div class="table-wrapper">
                    <table id="invoicesTable" class="data-table">
                        <thead>
                            <tr>
                                <th class="col-check"></th>
                                <th class="col-id">Invoice ID</th>
                                <th class="col-ref">Reference</th>
                                <th class="col-cpty">Counterparty</th>
                                <th class="col-strategy">Strategy</th>
                                <th class="col-tanker">Tanker</th>
                                <th class="col-item">Item Type</th>
                                <th class="col-amount">Amount</th>
                                <th class="col-balance">Balance</th>
                                <th class="col-curr">Curr</th>
                                <th class="col-date">Issue Date</th>
                                <th class="col-date">Due Date</th>
                                <th class="col-bank">Bank</th>
                                <th class="col-dir">Dir</th>
                            </tr>
                        </thead>
                        <tbody id="invoicesBody">
                            <tr class="loading-row">
                                <td colspan="14">Loading invoices...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Payments Grid -->
            <section class="grid-section">
                <div class="grid-header">
                    <h2>Payments</h2>
                    <div class="grid-actions">
                        <span id="paymentCount" class="count-badge">0</span>
                    </div>
                </div>
                <div class="grid-summary">
                    <span>Selected: <strong id="selectedPaymentsCount">0</strong></span>
                    <span>Amount: <strong id="selectedPaymentsAmount">0.00</strong></span>
                </div>
                <div class="table-wrapper">
                    <table id="paymentsTable" class="data-table">
                        <thead>
                            <tr>
                                <th class="col-check"></th>
                                <th class="col-ref">Reference</th>
                                <th class="col-cpty">Counterparty</th>
                                <th class="col-amount">Amount</th>
                                <th class="col-balance">Unallocated</th>
                                <th class="col-curr">Curr</th>
                                <th class="col-rate">Exch Rate</th>
                                <th class="col-date">Value Date</th>
                                <th class="col-account">Bank Account</th>
                                <th class="col-strategy">Strategy</th>
                                <th class="col-dir">Dir</th>
                            </tr>
                        </thead>
                        <tbody id="paymentsBody">
                            <tr class="loading-row">
                                <td colspan="11">Loading payments...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </div>

        <!-- Action Bar -->
        <section class="action-bar">
            <div class="allocation-input">
                <label for="allocationAmount">Allocation Amount:</label>
                <input type="number" id="allocationAmount" step="0.01" min="0" placeholder="Auto (full balance)">
            </div>
            <button id="createAllocationBtn" class="btn btn-primary btn-lg" disabled>
                Create Allocation
            </button>
            <div id="actionMessage" class="action-message hidden"></div>
        </section>

        <!-- Existing Allocations -->
        <section class="allocations-section">
            <div class="section-header">
                <h2>Recent Allocations</h2>
                <button id="toggleAllocations" class="btn btn-sm btn-secondary">Show/Hide</button>
            </div>
            <div id="allocationsWrapper" class="table-wrapper collapsed">
                <table id="allocationsTable" class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Invoice</th>
                            <th>Payment</th>
                            <th>Counterparty</th>
                            <th>Amount</th>
                            <th>Currency</th>
                            <th>Date</th>
                            <th>State</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="allocationsBody">
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
    <script src="/js/app.js"></script>
</body>
</html>
